trigger:
  branches:
    include:
      - main
      - master

  paths:
    include:
      - "docker-windows/*"

pool:
  vmImage: "windows-2019"
  #hcs::CreateComputeSystem b7f2f7dac7442e7dd233fda74062974e41c5a18318b85663ebbf3be5f804235f: The container operating system does not match the host operating system.


variables:
  workingDirectory: "$(System.DefaultWorkingDirectory)/docker-windows"
  imagetag: "$(Build.BuildId)"
  containerRegistry: "mywin001vm.azurecr.io"  # Replace with your registry URL
  repositoryName: "python3.9-demo"
  dockerRegistryServiceConnection: "mywin001vmAzureAcr"  # Replace with your service connection name

stages:
  - stage: Build
    displayName: "Build Stage"
    jobs:
      - job: BuildJob
        displayName: "Build and Test"
        steps:
          - task: PowerShell@2
            displayName: "Dump variables"
            inputs:
              targetType: "inline"
              script: |
                Write-Host "PowerShell task execution started"
                dir env:
              workingDirectory: "$(workingDirectory)"

          - task: Docker@2
            displayName: "Build and push Docker image"
            inputs:
              command: "buildAndPush"
              dockerfile: "$(workingDirectory)/DockerfilePythonOnly"
              buildContext: "$(workingDirectory)"
              repository: "$(containerRegistry)/$(repositoryName)"
              tags: $(imagetag)
              containerRegistry: "$(dockerRegistryServiceConnection)"
